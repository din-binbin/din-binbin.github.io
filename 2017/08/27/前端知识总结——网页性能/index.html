<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="性能优化," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="随着前端的页面功能越来越复杂，所依赖的库也就越来越多，因此页面加载越来越慢，因此性能问题凸显出来。">
<meta name="keywords" content="性能优化">
<meta property="og:type" content="article">
<meta property="og:title" content="前端知识总结——网页性能">
<meta property="og:url" content="http://binbin-io.github.io/2017/08/27/前端知识总结——网页性能/index.html">
<meta property="og:site_name" content="Thinking Coding">
<meta property="og:description" content="随着前端的页面功能越来越复杂，所依赖的库也就越来越多，因此页面加载越来越慢，因此性能问题凸显出来。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://binbin-io.github.io/images/performance-1.png">
<meta property="og:image" content="http://binbin-io.github.io/images/performance-2.png">
<meta property="og:image" content="http://binbin-io.github.io/images/performance-3.png">
<meta property="og:image" content="http://binbin-io.github.io/images/performance-4.png">
<meta property="og:image" content="http://binbin-io.github.io/images/performance-5.png">
<meta property="og:image" content="http://binbin-io.github.io/images/performance-6.png">
<meta property="og:image" content="http://binbin-io.github.io/images/performance-7.png">
<meta property="og:image" content="http://binbin-io.github.io/images/performance-8.png">
<meta property="og:updated_time" content="2017-09-25T17:39:42.689Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="前端知识总结——网页性能">
<meta name="twitter:description" content="随着前端的页面功能越来越复杂，所依赖的库也就越来越多，因此页面加载越来越慢，因此性能问题凸显出来。">
<meta name="twitter:image" content="http://binbin-io.github.io/images/performance-1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://binbin-io.github.io/2017/08/27/前端知识总结——网页性能/"/>





  <title>前端知识总结——网页性能 | Thinking Coding</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Thinking Coding</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://binbin-io.github.io/2017/08/27/前端知识总结——网页性能/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="白发渔樵">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thinking Coding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">前端知识总结——网页性能</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-27T01:30:50+08:00">
                2017-08-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>随着前端的页面功能越来越复杂，所依赖的库也就越来越多，因此页面加载越来越慢，因此性能问题凸显出来。<br><a id="more"></a></p>
<h1 id="为什么要关注性能"><a href="#为什么要关注性能" class="headerlink" title="为什么要关注性能"></a>为什么要关注性能</h1><ul>
<li>性能会影响用户体验</li>
<li>用户体验会影响网站收益</li>
</ul>
<hr>
<h1 id="window-performance"><a href="#window-performance" class="headerlink" title="window.performance"></a>window.performance</h1><p>为了更加精确地测量和提高网页和Web应用程序的性能够，W3C 和各浏览器厂商共同制定了 Web Performance API。</p>
<p>我们可以通过该接口查看用户访问网站各项性能数据，如连接建立时间、dns时间等信息，为更好地增强网页性能提供了前所未有的支持。</p>
<h2 id="浏览器内存相关-performance-memory"><a href="#浏览器内存相关-performance-memory" class="headerlink" title="浏览器内存相关 performance.memory"></a>浏览器内存相关 performance.memory</h2><p><code>performance.memory</code>可获取浏览器的内存情况,这个属性并不是标准的performance属性，只在chrome浏览器中。具体有以下值：</p>
<ul>
<li><code>usedJSHeapSize</code>表示所有被使用的js堆栈内存</li>
<li><code>totalJSHeapSize</code>表示当前js堆栈内存总大小</li>
<li><code>jsHeapSizeLimit</code>表示内存大小限制</li>
</ul>
<p>其中<code>usedJSHeapSize</code>不能大于<code>totalJSHeapSize</code>，如果大于则可能出现了内存泄漏的情况。</p>
<h2 id="网页导航相关-performance-navigation"><a href="#网页导航相关-performance-navigation" class="headerlink" title="网页导航相关 performance.navigation"></a>网页导航相关 performance.navigation</h2><p><code>performance.navigation</code>对象存储了两个属性，它们表示触发页面加载的原因。这些原因可能是页面重定向、前进后退按钮或者普通的URL加载。两个属性如下：</p>
<ul>
<li><p>performance.navigation.type</p>
<ul>
<li>值为一个整数值，表示网页的加载来源</li>
<li>0 （TYPE_NAVIGATENEXT）表示通过点击链接、地址栏输入、表单提交、脚本操作等方式加载</li>
<li>1 （TYPE_RELOAD）表示通过刷新操作或者 location.reload() 方法</li>
<li>2 （TYPE_BACK_FORWARD）表示通过历史遍历操作加载</li>
<li>255 （TYPE_UNDEFINED）表示其他来源的加载</li>
</ul>
</li>
<li><p>performance.navigation.redirectCount</p>
<ul>
<li>该属性表示到达当前页面，经过重定向的次数。</li>
</ul>
</li>
</ul>
<h2 id="时间相关-performance-timing"><a href="#时间相关-performance-timing" class="headerlink" title="时间相关 performance.timing"></a>时间相关 performance.timing</h2><p><code>performance.timing</code>对象包含了各种浏览器性能相关的信息如网站建立连接、DNS查询、DOM 解析等各项数据，使我们能够更为全面精确地了解网页性能的详细情况。</p>
<ul>
<li><code>navigationStart</code>：当前浏览器窗口的前一个网页关闭，发生unload事件时的时间。如果没有上一个页面，这个值会和 fetchStart 相同。通常我们也理解为准备加载新页面的起始时间。</li>
<li><code>redirectStart</code>：到当前页面的重定向开始的时间。当重定向的页面来自同一个域时这个属性才会有值，否则值为0。</li>
<li><code>redirectEnd</code>：到当前页面的重定向结束的时间。当重定向的页面来自同一个域时这个属性才会有值，否则值为0。</li>
<li><code>fetchStart</code>：准备使用HTTP请求(fetch)页面的时间。</li>
<li><code>domainLookupStart</code>：域名查询开始的时间。</li>
<li><code>domainLookupEnd</code>：域名查询结束的时间。</li>
<li><code>connectStart</code>：返回HTTP请求开始向服务器发送的时间,如果使用持久连接（persistent connection），则返回值等同于 fetchStart 的值。</li>
<li><code>(secureConnectionStart)</code>：可选特性。如果页面是HTTPS协议，则返回开始SSL握手的那个时间。如果当前网页不要求安全连接，则返回0。</li>
<li><code>connectEnd</code>：返回浏览器与服务器之间的连接建立的时间。如果建立的是持久连接，则返回值等同于fetchStart属性的值。连接建立指的是所有握手和认证过程全部结束。</li>
<li><code>requestStart</code>：返回浏览器向服务器发出HTTP请求时（或开始读取本地缓存时）的时间。</li>
<li><code>responseStart</code>：返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的时间。</li>
<li><code>responseEnd</code>：返回浏览器从服务器收到（或从本地缓存读取）最后一个字节时的时间。</li>
<li><code>unloadEventStart</code>：返回同一个域名前一个网页的 unload 事件触发时的时间。否则返回值为0。</li>
<li><code>unloadEventEnd</code>：返回同一个域名前一个网页的 unload 事件触发时的时间。否则返回值为0。</li>
<li><code>domLoading</code>：返回当前网页 DOM 结构开始解析时（即Document.readyState属性变为 loading、相应的readystatechange事件触发时）的时间。</li>
<li><code>domInteractive</code>：返回当前网页DOM结构结束解析、开始加载内嵌资源时（即Document.readyState属性变为 interactive 、相应的readystatechange事件触发时）的时间。</li>
<li><code>domContentLoadedEventStart</code>：返回当解析器发送 DOMContentLoaded 事件的开始时间</li>
<li><code>domContentLoadedEventEnd</code>：返回当文档的 DOMContentLoaded 事件的结束时间。</li>
<li><code>domComplete</code>：返回当前文档解析完成，即Document.readyState 变为 complete 且相对应的readystatechange 被触发时的时间。</li>
<li><code>loadEventStart</code>：返回该文档下，load 事件被发送时的时间。如果这个事件还未被发送，它的值将会是0。</li>
<li><code>loadEventEnd</code>：返回当 load 事件结束，即加载事件完成时的时间。如果这个事件还未被发送，或者尚未完成，它的值将会是0。</li>
</ul>
<h2 id="计算相关节点"><a href="#计算相关节点" class="headerlink" title="计算相关节点"></a>计算相关节点</h2><p>可以通过上面的属性计算出许多网页的信息。</p>
<ul>
<li><p>页面经历了多长时间</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> duration = <span class="built_in">Date</span>.now() - t.navigationStart;</div></pre></td></tr></table></figure>
</li>
<li><p>网页加载整个过程的(onload)耗时</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> timing = performance.timing; </div><div class="line"><span class="keyword">var</span> pageLoadTime = timing.loadEventEnd - t.navigationStart;</div></pre></td></tr></table></figure>
</li>
<li><p>DNS 域名解析的耗时</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> timing = performance.timing; </div><div class="line"><span class="keyword">var</span> dns = timing.domainLookupEnd - t.domainLookupStart;</div></pre></td></tr></table></figure>
</li>
<li><p>TCP 连接的耗时</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> timing = performance.timing; </div><div class="line"><span class="keyword">var</span> tcp = timing.connectEnd - t.connectStart;</div></pre></td></tr></table></figure>
</li>
<li><p>TTFB 获取首字节的耗时</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> timing = performance.timing; </div><div class="line"><span class="keyword">var</span> ttfb = timing.responseStart - t.navigationStart;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="返回时间-performance-now"><a href="#返回时间-performance-now" class="headerlink" title="返回时间 performance.now()"></a>返回时间 performance.now()</h2><p><code>performance.now</code>方法将会返回当前网页自从<code>performance.timing.navigationStart</code>到当前时间之间的微秒数（毫秒的千分之一）。</p>
<p><code>performance.now()</code>返回的时间近似于<code>Date.now()</code>。但前者的时间精度是后者的 1000 倍。</p>
<h2 id="资源加载相关-performance-getEntries"><a href="#资源加载相关-performance-getEntries" class="headerlink" title="资源加载相关 performance.getEntries()"></a>资源加载相关 performance.getEntries()</h2><p>浏览器获取网页时，会对网页中每一个资源文件（js、css、图片等）发出一个HTTP请求。<code>performance.getEntries</code>会统计这些请求并且返回相应的时间信息。</p>
<p>更多关于 Window.performance ，可参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/performance" target="_blank" rel="external">Window.performance</a></p>
<hr>
<h1 id="性能衡量指标"><a href="#性能衡量指标" class="headerlink" title="性能衡量指标"></a>性能衡量指标</h1><p>If you cannot measure it,you cannot improve it.</p>
<p>打开一个页面会发生如下过程：</p>
<p><img src="/images/performance-1.png" alt="open web"></p>
<ul>
<li>开始请求：performance.timing.navigationStart</li>
<li>获取首字节：performance.timing.responseStart</li>
<li>页面开始展示：白屏时间</li>
<li>首屏内容加载完成：首屏时间</li>
<li>加载完成</li>
</ul>
<p>其中，获取首字节、白屏时间、首屏时间这三个时间是主要的性能衡量指标。</p>
<hr>
<h1 id="Date类型"><a href="#Date类型" class="headerlink" title="Date类型"></a>Date类型</h1><p>在 JS 中，通常使用<code>Date</code>类型来表示日期。</p>
<p>由于 JS 中的<code>Date</code>类型是在早期 Java 中的 <code>java.util.Date</code> 类基础上构建的，所以 JS 的<code>Date</code>类型使用的是自 UTC 1970年1月1日0时0分0秒（世界标准时间）起的毫秒数。</p>
<h2 id="日期对象"><a href="#日期对象" class="headerlink" title="日期对象"></a>日期对象</h2><p>调用 <code>new Date()</code> 获取当前时间，函数返回的是日期对象，这个对象有很多方法可以获取日期的信息。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 当前时间</span></div><div class="line"><span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">// Tue Aug 08 2017 15:41:26 GMT+0800 (CST)</span></div></pre></td></tr></table></figure>
<p>除此之外，还可以传入参数使用，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> today = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">1453094034000</span>); <span class="comment">// by timestamp(accurate to the millimeter)</span></div><div class="line"><span class="keyword">var</span> birthday = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'December 17, 1995 03:24:00'</span>);</div><div class="line"><span class="keyword">var</span> birthday = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'1995-12-17T03:24:00'</span>);</div><div class="line"><span class="keyword">var</span> birthday = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">1995</span>, <span class="number">11</span>, <span class="number">17</span>);</div><div class="line"><span class="keyword">var</span> birthday = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">1995</span>, <span class="number">11</span>, <span class="number">17</span>, <span class="number">3</span>, <span class="number">24</span>, <span class="number">0</span>);</div></pre></td></tr></table></figure>
<p>其参数规则如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// value 代表自1970年1月1日00:00:00 (世界标准时间) 起经过的毫秒数</span></div><div class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(value);</div><div class="line"></div><div class="line"><span class="comment">// 表示日期的字符串值</span></div><div class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(dateString);</div><div class="line"></div><div class="line"><span class="comment">// year 代表年份的整数值，为了避免2000年问题最好指定4位数的年份; 如使用 1998, 而不要用 98</span></div><div class="line"><span class="comment">// month 代表月份的整数值从0（1月）到11（12月）</span></div><div class="line"><span class="comment">// day 代表一个月中的第几天的整数值，从1开始</span></div><div class="line"><span class="comment">// hour 代表一天中的小时数的整数值 (24小时制)，minute 分钟数，second 秒数，millisecond 毫秒数</span></div><div class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(year, month[, day[, hour[, minutes[, seconds[, milliseconds]]]]]);</div></pre></td></tr></table></figure>
<h2 id="静态方法-——-now-方法"><a href="#静态方法-——-now-方法" class="headerlink" title="静态方法 —— now 方法"></a>静态方法 —— now 方法</h2><p>ES5中添加了<code>Date.now()</code>方法，返回表示调用这个方法时的日期和时间的毫秒数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 记录开始时间</span></div><div class="line"><span class="keyword">var</span> start = <span class="built_in">Date</span>.now();</div><div class="line"></div><div class="line"><span class="comment">// 这里运行一段代码</span></div><div class="line">doSomething();</div><div class="line"></div><div class="line"><span class="comment">// 记录结束时间</span></div><div class="line"><span class="keyword">var</span> stop = <span class="built_in">Date</span>.now();</div><div class="line"></div><div class="line"><span class="comment">// 得到代码运行时间</span></div><div class="line"><span class="keyword">var</span> timeUse = start - stop;</div></pre></td></tr></table></figure>
<h2 id="实例方法-——-Getter"><a href="#实例方法-——-Getter" class="headerlink" title="实例方法 —— Getter"></a>实例方法 —— Getter</h2><ul>
<li><code>getFullYear()</code>：根据本地时间返回指定日期对象的年份（四位数年份时返回四位数字）</li>
<li><code>getMonth()</code>：根据本地时间返回指定日期对象的月份（0-11）</li>
<li><code>getDate()</code>：根据本地时间返回指定日期对象的月份中的第几天（1-31）</li>
<li><code>getDay()</code>：根据本地时间返回指定日期对象的星期中的第几天（0-6）</li>
<li><code>getHours()</code>：根据本地时间返回指定日期对象的小时（0-23）</li>
<li><code>getMinutes()</code>：根据本地时间返回指定日期对象的分钟（0-59）</li>
<li><code>getSeconds()</code>：根据本地时间返回指定日期对象的秒数（0-59）</li>
<li><code>getMilliseconds()</code>：根据本地时间返回指定日期对象的微秒（0-999）</li>
<li><code>getTime()</code>：返回从1970-1-1 00:00:00 UTC（协调世界时）到该日期经过的毫秒数，对于1970-1-1 00:00:00 UTC之前的时间返回负值。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 将时间格式化为：YYYY-MM-DD HH:mm:ss</span></div><div class="line"></div><div class="line"><span class="comment">// 小于或等于9的数字前面添加0</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">addZero</span>(<span class="params">num</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> num &gt; <span class="number">9</span> ? num : <span class="string">'0'</span> + num;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 格式化时间，可传入一个时间或使用当前时间</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dateFormat</span>(<span class="params">date</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> date = date ? <span class="keyword">new</span> <span class="built_in">Date</span>(date) : <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">    <span class="keyword">var</span> str = date.getFullYear() + <span class="string">'-'</span> + addZero(date.getMonth() + <span class="number">1</span>) + <span class="string">'-'</span> + addZero(date.getDate()) + <span class="string">' '</span> + addZero(date.getHours()) + <span class="string">':'</span> + addZero(date.getMinutes()) + <span class="string">':'</span> + addZero(date.getSeconds());</div><div class="line"></div><div class="line">    <span class="keyword">return</span> str;</div><div class="line">&#125;</div><div class="line"></div><div class="line">dateFormat(); <span class="comment">// 2017-08-07 17:44:51</span></div><div class="line">dateFormat(<span class="number">1502095046000</span>); <span class="comment">// 2017-08-07 16:37:26</span></div><div class="line">dateFormat(<span class="string">'December 3, 1995 03:19:05'</span>); <span class="comment">// 1995-12-03 03:19:05</span></div></pre></td></tr></table></figure>
<p>对于格式化时间这么常用的功能,可以借助<a href="http://momentjs.cn/" target="_blank" rel="external">Moment.js</a>库。</p>
<h2 id="实例方法-——-Setter"><a href="#实例方法-——-Setter" class="headerlink" title="实例方法 —— Setter"></a>实例方法 —— Setter</h2><ul>
<li><code>setFullYear()</code>：根据本地时间为指定日期对象设置完整年份（四位数年份是四个数字）</li>
<li><code>setMonth()</code>：根据本地时间为指定日期对象设置月份</li>
<li><code>setDate()</code>：根据本地时间为指定的日期对象设置月份中的第几天</li>
<li><code>setHours()</code>：根据本地时间为指定日期对象设置小时数</li>
<li><code>setMinutes()</code>：根据本地时间为指定日期对象设置分钟数</li>
<li><code>setSeconds()</code>：根据本地时间为指定日期对象设置秒数</li>
<li><code>setMilliseconds()</code>：根据本地时间为指定日期对象设置毫秒数</li>
<li><code>setTime()</code>：通过指定从 1970-1-1 00:00:00 UTC 开始经过的毫秒数来设置日期对象的时间，对于早于 1970-1-1 00:00:00 UTC的时间可使用负值。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 2017 年 IMWebconf 大会开始时间为： 2017-09-16 09:30:00</span></div><div class="line"><span class="comment">// 计算大会时间的倒计时</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> nowTime = <span class="built_in">Date</span>.now(); <span class="comment">// 1502189810994，这个时间会变动</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> confDate = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2017</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">9</span>, <span class="number">30</span>, <span class="number">0</span>),</div><div class="line">    confTime = confDate.getTime(); <span class="comment">// 1505525400000</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> diffTime = <span class="built_in">parseInt</span>((confTime - nowTime) / <span class="number">1000</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span>(diffTime &gt; <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">var</span> days = <span class="built_in">parseInt</span>(diffTime / (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>)); <span class="comment">// 得到剩余天数</span></div><div class="line">    <span class="keyword">var</span> hours = <span class="built_in">parseInt</span>((diffTime % (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>)) / (<span class="number">60</span> * <span class="number">60</span>)); <span class="comment">// 得到剩余小时</span></div><div class="line">    <span class="keyword">var</span> minutes = <span class="built_in">parseInt</span>(((diffTime % (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>)) % (<span class="number">60</span> * <span class="number">60</span>)) / <span class="number">60</span>); <span class="comment">// 得到剩余分钟</span></div><div class="line">    <span class="keyword">var</span> seconds = ((diffTime % (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>)) % (<span class="number">60</span> * <span class="number">60</span>)) % <span class="number">60</span>; <span class="comment">// 得到剩余秒</span></div><div class="line">    <span class="comment">// 距离大会还剩38天14:33:9，依赖于 nowTime 为 1502189810994 的计算</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'距离大会还剩'</span> + days + <span class="string">'天'</span> + hours + <span class="string">':'</span> + minutes + <span class="string">':'</span> + seconds);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'大会已经圆满结束，敬请期待下一次大会！'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同样对于倒计时，也有很多库可用：<a href="http://www.cnblogs.com/lhb25/archive/2012/12/05/12-essential-countdown-timer-scripts.html" target="_blank" rel="external">12个效果精美的JavaScript倒计时脚本</a></p>
<p>更多关于Date可参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" rel="external">Date</a></p>
<hr>
<h1 id="白屏时间"><a href="#白屏时间" class="headerlink" title="白屏时间"></a>白屏时间</h1><p><img src="/images/performance-2.png" alt="performance-2"></p>
<p>通常，我们认为当开始解析body的时候，就是开始看到内容的时候。因此可在head标签末尾插入脚本获取时间，再减去开始请求时间，就是白屏时间。</p>
<p><img src="/images/performance-3.png" alt="performance-3"></p>
<hr>
<h1 id="首屏时间"><a href="#首屏时间" class="headerlink" title="首屏时间"></a>首屏时间</h1><p><img src="/images/performance-4.png" alt="performance-4"></p>
<p><img src="/images/performance-5.png" alt="performance-5"></p>
<p><img src="/images/performance-6.png" alt="performance-6"></p>
<hr>
<h1 id="业务中如何计算白屏和首屏时间"><a href="#业务中如何计算白屏和首屏时间" class="headerlink" title="业务中如何计算白屏和首屏时间"></a>业务中如何计算白屏和首屏时间</h1><p>白屏时间和首屏时间是我们衡量网站加载性能的两个重要指标。在开发中，我们需要根据业务页面的具体情况，相应地统计页面白屏时间和首屏时间。对于白屏时间和首屏时间，计算的原理是不变的，但计算的的方式可能会根据页面情况有所改变，因此需要具体问题具体分析。</p>
<h2 id="计算白屏时间"><a href="#计算白屏时间" class="headerlink" title="计算白屏时间"></a>计算白屏时间</h2><p>白屏时间指的是浏览器开始显示内容的时间。</p>
<p>我们知道以下几点：</p>
<ul>
<li>浏览器在加载页面的刚开始，页面是处于空白的状态，只有当页面发生绘制操作时会开始显示内容。</li>
<li>浏览器加载页面是一个渐进的过程。为达到更好的用户体验，呈现引擎会力求尽快将内容显示在屏幕上。它不必等到整个 HTML 文档解析完毕之后，就会开始构建呈现树和设置布局。在不断接收页面内容的同时，呈现引擎会将部分内容解析并显示出来。</li>
<li>非可视化的 DOM 元素不会显示到窗口中，例如 <code>&lt;head&gt;</code>，这就意味着浏览器在绘制之前，至少需要先解析完head元素中的内容。</li>
</ul>
<p>因此，我们通常认为浏览器开始渲染 <code>&lt;body&gt;</code> 标签或者解析完 <code>&lt;head&gt;</code> 标签的时刻就是页面白屏结束的时间点。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>白屏<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">    <span class="comment">// 不兼容performance.timing 的浏览器，如IE8</span></span></div><div class="line"><span class="javascript">    <span class="built_in">window</span>.pageStartTime = <span class="built_in">Date</span>.now();</span></div><div class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- 页面 CSS 资源 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"common.css"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"page.css"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">    <span class="comment">// 白屏时间结束点</span></span></div><div class="line"><span class="javascript">    <span class="built_in">window</span>.firstPaint = <span class="built_in">Date</span>.now();</span></div><div class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- 页面内容 --&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>因此白屏时间则可以这样计算出：</p>
<ul>
<li><p>可使用 Performance API 时</p>
<ul>
<li><code>白屏时间 = firstPaint - performance.timing.navigationStart;</code></li>
</ul>
</li>
<li><p>不可使用 Performance API 时</p>
<ul>
<li><code>白屏时间 = firstPaint - pageStartTime;</code></li>
</ul>
</li>
</ul>
<h2 id="计算首屏时间"><a href="#计算首屏时间" class="headerlink" title="计算首屏时间"></a>计算首屏时间</h2><p>首屏时间是指用户打开网站开始，到浏览器首屏内容渲染完成的时间。对于用户体验来说，首屏时间是用户对一个网站的重要体验因素。通常一个网站，如果首屏时间在5秒以内是比较优秀的，10秒以内是可以接受的，10秒以上就不可容忍了。超过10秒的首屏时间用户会选择刷新页面或立刻离开。</p>
<p>现实中，不同业务的首屏内容并不是一样的。因此计算首屏时间，需要根据业务页面情况，相应地选择计算首屏时间的方法。通常计算首屏的方法有：</p>
<ul>
<li><p>首屏模块标签标记法(通常适用于首屏内容不需要通过拉取数据才能生存以及页面不考虑图片等资源加载的情况)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>首屏<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">    <span class="built_in">window</span>.pageStartTime = <span class="built_in">Date</span>.now();</span></div><div class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"common.css"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"page.css"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- 首屏可见模块1 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"module-1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- 首屏可见模块2 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"module-2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">    <span class="built_in">window</span>.firstScreen = <span class="built_in">Date</span>.now();</span></div><div class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- 首屏不可见模块3 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"module-3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 首屏不可见模块4 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"module-4"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>此时首屏时间等于 <code>firstScreen - performance.timing.navigationStart;</code></p>
<p>事实上首屏模块标签标记法 在业务中的情况比较少，大多数页面都需要通过接口拉取数据才能完整展示，因此我们会使用 JavaScript 脚本来判断首屏页面内容加载情况。</p>
</blockquote>
</li>
<li><p>统计首屏内加载最慢的图片的时间</p>
<blockquote>
<p>通常我们首屏内容加载最慢的就是图片资源，因此我们会把首屏内加载最慢的图片的时间当做首屏的时间。</p>
<p>由于浏览器对每个页面的 TCP 连接数有限制，使得并不是所有图片都能立刻开始下载和显示。因此我们在 DOM树 构建完成后将会去遍历首屏内的所有图片标签，并且监听所有图片标签 <code>onload</code> 事件，最终遍历图片标签的加载时间的最大值，并用这个最大值减去 <code>navigationStart</code> 即可获得近似的首屏时间。</p>
<p>此时首屏时间等于 <code>加载最慢的图片的时间点 - performance.timing.navigationStart;</code></p>
</blockquote>
</li>
<li><p>自定义首屏内容计算法</p>
<blockquote>
<p>由于统计首屏内图片完成加载的时间比较复杂。因此我们在业务中通常会通过自定义模块内容，来简化计算首屏时间。如下面的做法：</p>
<ul>
<li>忽略图片等资源加载情况，只考虑页面主要 DOM</li>
<li>只考虑首屏的主要模块，而不是严格意义首屏线以上的所有内容</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>对于首屏时间和白屏时间，业界并没有一个统一的计算标准。</p>
<p>应该根据首屏时间和白屏时间的具体原理，切合自身业务情况来制定统计的方法。</p>
<p>统计首屏时间和白屏时间是为了让我们能够更明白我们业务页面的情况，而不是为了统计而去统计。</p>
<hr>
<h1 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h1><p>可以去测量性能了，那么接下来就是去优化提高性能表现。</p>
<p>形象化一点，现在浏览器要派一辆卡车去服务器运一堆货物回来，那么为了加快这个进程，我们可以做以下几点：</p>
<ul>
<li>卡车每次多装货，争取一次或者很少的次数就运完</li>
<li>卡车的速度提高，缩短运输时间</li>
<li>把货物里没用的杂物去掉</li>
</ul>
<p>于是可以总结出三大常用优化手段；</p>
<ul>
<li>减少请求文件数</li>
<li>减少资源体积</li>
<li>提高网络传输速度</li>
</ul>
<h2 id="减少请求文件数"><a href="#减少请求文件数" class="headerlink" title="减少请求文件数"></a>减少请求文件数</h2><p>通过分析网页加载，可以知道大多数的响应时间都花在图片、样式、脚本等资源的下载上。</p>
<p>因为文件请求会发生如下几个流程:</p>
<ul>
<li>DNS 解析和寻址</li>
<li>服务器建立连接</li>
<li>发送数据</li>
<li>等待服务器响应</li>
<li>接受数据</li>
<li>。。。</li>
</ul>
<p>以上流程也是请求主要耗时所在，当请求变多，服务器压力变大，页面加载变慢。</p>
<p>如何减少请求数：</p>
<ul>
<li>小图片合并雪碧图或者使用iconfont</li>
<li>JavaScript、CSS文件合并</li>
</ul>
<h2 id="减少资源体积"><a href="#减少资源体积" class="headerlink" title="减少资源体积"></a>减少资源体积</h2><ul>
<li>精简代码</li>
<li>压缩CSS、JavaScript、图片<ul>
<li>可以通过在线工具、clean-css、UglifyJS、imagemin</li>
</ul>
</li>
<li>开启Gzip<ul>
<li>一种压缩方案</li>
<li>服务端通过Gzip编码压缩文件后再发送</li>
<li>浏览器对文件进行Gzip解码</li>
<li>Gzip最高能压缩90%多，大大节省网络带宽</li>
</ul>
</li>
</ul>
<h2 id="提高网络传输"><a href="#提高网络传输" class="headerlink" title="提高网络传输"></a>提高网络传输</h2><ul>
<li>使用浏览器缓存<ul>
<li>减少网络资源加载，更快展示页面</li>
</ul>
</li>
<li>使用CND<ul>
<li>CDN，即Content Delivery Network，内容分发网络</li>
<li>可以让用户就近的访问到请求的资源</li>
</ul>
</li>
</ul>
<p><img src="/images/performance-7.png" alt="performance-7"></p>
<hr>
<h1 id="CND"><a href="#CND" class="headerlink" title="CND"></a>CND</h1><p>为了提高网页应用的加载速度，我们会使用到浏览器缓存，然而浏览器缓存只能提升二次访问的速度。对于加速首次访问的速度，我们最常见的手段则是使用 CDN 加速。</p>
<p>CDN 的全称是 Content Delivery Network，即内容分发网络。通过将静态资源缓存到离用户很近的相同网络运营商的 CDN 节点上，使用户可以就近取得所需的内容，解决网络拥塞状况，提高用户访问网站的响应速度。</p>
<p><img src="/images/performance-8.png" alt="performance-8"></p>
<h2 id="CDN-服务的大致流程"><a href="#CDN-服务的大致流程" class="headerlink" title="CDN 服务的大致流程"></a>CDN 服务的大致流程</h2><ul>
<li>1 选择 CDN 供应商<blockquote>
<p>现阶段 CDN 云服务商的竞争已经由 技术 逐渐取代价格成为 CDN 厂商在客户谈判时最关键因素，技术更高的 CDN 服务能够降低带宽成本、提升用户体验。</p>
<p>这里列举国内比较出名的 CDN 厂商：<a href="https://www.upyun.com/" target="_blank" rel="external">叉拍云</a>、<a href="https://cloud.tencent.com/" target="_blank" rel="external">腾讯云</a>、<a href="https://www.qiniu.com/" target="_blank" rel="external">七牛云</a>、<a href="https://www.alibabacloud.com/zh" target="_blank" rel="external">阿里云</a></p>
</blockquote>
</li>
<li>2 连接 CDN 服务<blockquote>
<p>通常购买了 CDN 服务后，该 CDN 服务会提供相应的接口让我们去上传和部署我们的资源。</p>
<p>这部分的工作通常是由我们运维人员去负责的，对于一些小公司可能则需要前端或者后台人员去负责连接 CDN 服务，使业务能够部署静态资源到相应的服务器上。</p>
</blockquote>
</li>
<li>3 前端工程静态资源部署<ul>
<li>3.1 将静态资源部署到不同网络线路的服务器中<blockquote>
<p>由于用户的网络线路有很多种，如网通、电信、移动等，为了让不同地区的用户会访问到离自己最近的相同网络线路上的 CDN 节点。因此我们需要将我们的资源部署到不同的网络线路的服务器中，然后通过这些服务器同步到不同线路的 CDN 节点上。</p>
</blockquote>
</li>
<li>3.2 加载静态资源时需使用与页面不同的域名<blockquote>
<p>使用不同的域名来加载 CDN 服务的静态资源，一方面便于接入为 CDN 时设置 DNS 的智能解析。另一方面当静态资源和主页面使用不同的域名，在加载静态资源时 HTTP 请求并不会带上主域页面的 Cookie 等数据，较少了请求时的数据传输量，进一步加快网络访问。</p>
</blockquote>
</li>
<li>3.3 资源路径的修正<blockquote>
<p>通常情况下，我们的资源都是在本地，比如有个 JS 文件，我们在 HTML 里面按照相对目录引用它：</p>
<p><code>&lt;script src=&quot;js/script.js&quot;&gt;&lt;/script&gt;</code></p>
<p>使用了 CDN 的话，资源都部署到了 CDN 服务器上去咯，这个时候我们必须用绝对路径来引用：</p>
<p><code>&lt;script src=&quot;http://xxx.xxx.xxx/js/script.js&quot;&gt;&lt;/script&gt;</code></p>
<p>这个过程当然不能手动，通常都是在工程化里面解决这个问题。</p>
</blockquote>
</li>
</ul>
</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/性能优化/" rel="tag"># 性能优化</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/25/前端知识总结——浏览器渲染/" rel="next" title="前端知识总结——浏览器渲染">
                <i class="fa fa-chevron-left"></i> 前端知识总结——浏览器渲染
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/28/前端知识总结——Node.js入门/" rel="prev" title="前端知识总结——Node.js入门">
                前端知识总结——Node.js入门 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="白发渔樵" />
          <p class="site-author-name" itemprop="name">白发渔樵</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#为什么要关注性能"><span class="nav-number">1.</span> <span class="nav-text">为什么要关注性能</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#window-performance"><span class="nav-number">2.</span> <span class="nav-text">window.performance</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#浏览器内存相关-performance-memory"><span class="nav-number">2.1.</span> <span class="nav-text">浏览器内存相关 performance.memory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网页导航相关-performance-navigation"><span class="nav-number">2.2.</span> <span class="nav-text">网页导航相关 performance.navigation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#时间相关-performance-timing"><span class="nav-number">2.3.</span> <span class="nav-text">时间相关 performance.timing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#计算相关节点"><span class="nav-number">2.4.</span> <span class="nav-text">计算相关节点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#返回时间-performance-now"><span class="nav-number">2.5.</span> <span class="nav-text">返回时间 performance.now()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#资源加载相关-performance-getEntries"><span class="nav-number">2.6.</span> <span class="nav-text">资源加载相关 performance.getEntries()</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#性能衡量指标"><span class="nav-number">3.</span> <span class="nav-text">性能衡量指标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Date类型"><span class="nav-number">4.</span> <span class="nav-text">Date类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#日期对象"><span class="nav-number">4.1.</span> <span class="nav-text">日期对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#静态方法-——-now-方法"><span class="nav-number">4.2.</span> <span class="nav-text">静态方法 —— now 方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实例方法-——-Getter"><span class="nav-number">4.3.</span> <span class="nav-text">实例方法 —— Getter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实例方法-——-Setter"><span class="nav-number">4.4.</span> <span class="nav-text">实例方法 —— Setter</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#白屏时间"><span class="nav-number">5.</span> <span class="nav-text">白屏时间</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#首屏时间"><span class="nav-number">6.</span> <span class="nav-text">首屏时间</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#业务中如何计算白屏和首屏时间"><span class="nav-number">7.</span> <span class="nav-text">业务中如何计算白屏和首屏时间</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#计算白屏时间"><span class="nav-number">7.1.</span> <span class="nav-text">计算白屏时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#计算首屏时间"><span class="nav-number">7.2.</span> <span class="nav-text">计算首屏时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">7.3.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#性能优化"><span class="nav-number">8.</span> <span class="nav-text">性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#减少请求文件数"><span class="nav-number">8.1.</span> <span class="nav-text">减少请求文件数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#减少资源体积"><span class="nav-number">8.2.</span> <span class="nav-text">减少资源体积</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#提高网络传输"><span class="nav-number">8.3.</span> <span class="nav-text">提高网络传输</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CND"><span class="nav-number">9.</span> <span class="nav-text">CND</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CDN-服务的大致流程"><span class="nav-number">9.1.</span> <span class="nav-text">CDN 服务的大致流程</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">白发渔樵</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Gemini
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
